<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Instant Control Panel</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="main-container">
        <h1 class="main-title">PYROBOT</h1>

        <div class="video-window">
            <div class="video-placeholder">
                <img src="{{ url_for('video_feed') }}" alt="" class="feed-img">
                <div class="label">LIVE FEED</div>
            </div>
        </div>

        <div class="controls-wrapper">
            <div class="dpad-container">
                <div class="dpad">
    <button class="btn diag up-left" onpointerdown="this.classList.add('active-press'); send('upleft', 'start')" onpointerup="this.classList.remove('active-press'); send('upleft', 'stop')" onpointerleave="this.classList.remove('active-press'); send('upleft', 'stop')">
        <i class="fas fa-caret-up"></i>
    </button>
    <button class="btn up" onpointerdown="this.classList.add('active-press'); send('forward', 'start')" onpointerup="this.classList.remove('active-press'); send('forward', 'stop')" onpointerleave="this.classList.remove('active-press'); send('forward', 'stop')">
        <i class="fas fa-caret-up"></i>
    </button>
    <button class="btn diag up-right" onpointerdown="this.classList.add('active-press'); send('upright', 'start')" onpointerup="this.classList.remove('active-press'); send('upright', 'stop')" onpointerleave="this.classList.remove('active-press'); send('upright', 'stop')">
        <i class="fas fa-caret-up"></i>
    </button>

    <button class="btn left" onpointerdown="this.classList.add('active-press'); send('left', 'start')" onpointerup="this.classList.remove('active-press'); send('left', 'stop')" onpointerleave="this.classList.remove('active-press'); send('left', 'stop')">
        <i class="fas fa-caret-left"></i>
    </button>
    <div class="dpad-center-logo"><i class="fas fa-circle"></i></div>
    <button class="btn right" onpointerdown="this.classList.add('active-press'); send('right', 'start')" onpointerup="this.classList.remove('active-press'); send('right', 'stop')" onpointerleave="this.classList.remove('active-press'); send('right', 'stop')">
        <i class="fas fa-caret-right"></i>
    </button>

    <button class="btn diag down-left" onpointerdown="this.classList.add('active-press'); send('downleft', 'start')" onpointerup="this.classList.remove('active-press'); send('downleft', 'stop')" onpointerleave="this.classList.remove('active-press'); send('downleft', 'stop')">
        <i class="fas fa-caret-down"></i>
    </button>
    <button class="btn down" onpointerdown="this.classList.add('active-press'); send('backward', 'start')" onpointerup="this.classList.remove('active-press'); send('backward', 'stop')" onpointerleave="this.classList.remove('active-press'); send('backward', 'stop')">
        <i class="fas fa-caret-down"></i>
    </button>
    <button class="btn diag down-right" onpointerdown="this.classList.add('active-press'); send('downright', 'start')" onpointerup="this.classList.remove('active-press'); send('downright', 'stop')" onpointerleave="this.classList.remove('active-press'); send('downright', 'stop')">
        <i class="fas fa-caret-down"></i>
    </button>
</div>
            </div>

            <div class="action-buttons-container">
                <button class="btn round horn-toggle" id="hornBtn" onclick="toggleHorn()">
                    <i id="hornIcon" class="fas fa-bullhorn"></i>
                </button>
                <button class="btn round light-toggle" id="lightBtn" onclick="toggleLight()">
                    <i id="lightIcon" class="far fa-lightbulb"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        let lightOn = false;
        let hornOn = false;
        function send(action, state) {
            fetch(`/control/${action}/${state}`, { method: 'GET', keepalive: true });
        }
        function toggleLight() {
            lightOn = !lightOn;
            const btn = document.getElementById('lightBtn');
            const icon = document.getElementById('lightIcon');
            if (lightOn) {
                btn.classList.add('active-light');
                icon.className = 'fas fa-lightbulb';
                send('light', 'on');
            } else {
                btn.classList.remove('active-light');
                icon.className = 'far fa-lightbulb';
                send('light', 'off');
            }
        }
        function toggleHorn() {
            hornOn = !hornOn;
            const btn = document.getElementById('hornBtn');
            if (hornOn) {
                btn.classList.add('active-horn');
                send('horn', 'start');
            } else {
                btn.classList.remove('active-horn');
                send('horn', 'stop');
            }
        }
    </script>
</body>
</html>